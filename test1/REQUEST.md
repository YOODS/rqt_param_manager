# rqt_param_manager 設計変更

## 1. 起動
~~~
[ROS_NAMESPACE=<prefix>] rqt_param_manager [conf:=<config file>] [dump:=<yaml file>]
~~~
- config fileは項目など設定ファイル。*省略時はカレントの[D|d]efault.pmconfを使う*
- config fileのパラメータ名が **/** 以外で始まるときは、*prefix* をその前に結合します。

## 2. Config file
- テキスト形式のファイルにて、１行が表示項目の１行に対応する。
- 項目分類は以下の３種類
  - パラメータ(Number,String,Array??)
  - サービス(std_srvs/Triggerのみ)
  - コメント
  
### 2-1. 画面表示  

  rqt_param_managerの画面表示例を示します。
表示項目は、第1列がラベル、第2列がInput、第3列がButton、に分類されます。
<table border>
<tr><th>第1列<th>第2列<th>第3列
<tr><td colspan="3">位相シフト用パラメータ
<tr><td>再投影誤差<td>0.222
<tr><td>露光時間(usec)<td>10000
<tr><td>カメラID<td>YOODS
<tr><td>モデルデータファイル<td>model1.ply<td>＜一覧＞
<tr><td>3D撮像<td><td>＜実行＞
</table>

この表示に従いconfig fileの書式を示す。

### 2-2. コメントの表記  
表示例の１行目がコメントです。コメントはUIをわかりやすくするもので、＜保存＞ボタン操作の対象外です。  
この表示に対応するConfig fileでの記述は下記となります。
~~~
"Echo:","位相シフト用パラメータ"
~~~
*"Echo:"* の後にTopic名が続くときは、このTopicをsubscribeし表示します。2行目がその表示例です。  
この表示に対応するConfig fileでの記述は下記となります。
~~~
"Echo:gridboard/error","再投影誤差"
~~~

### 2-3. 数値パラメータの表記
表示例の3行目が数値パラメータです。  
この表示に対応するConfig fileでの記述は下記となります。
~~~
"Number:camera/ExposureTime","露光時間(usec)"
~~~

第2列を編集中は文字色が**赤**となり、変更イベントで値の書込が完了すると黒に戻ります(＜更新＞ボタンは削除)。

また**Number:**が省略されている時は数値パラメータと解釈されます。よって下記は同じ結果となります。
~~~
"camera/ExposureTime","露光時間(usec)"
~~~
数値パラメータには、将来的には、**表示ゲイン、表示フォーマット、入力上下限値**が追加される予定です。

### 2-4. 文字パラメータの表記  
表示例の4行目が文字パラメータです。  
この表示に対応するConfig fileでの記述は下記となります。
~~~
"Text:camera/ID","カメラID"
~~~
### 2-5. ファイルパラメータの表記(*この機能は2018.12時点では未実装でよい*)  
表示例の5行目がファイルパラメータです。  
ファイルパラメータは文字パラメータに分類されますが、入力手段がキー以外にファイルリストから選べるようになったものです。
この表示に対応するConfig fileでの記述は下記となります。
~~~
"File:solver/model_name","モデルデータファイル","data/*.ply"
~~~

＜一覧＞ボタンを押すと、ダイアログが開き、"data/*.ply"規則に合致するファイル一覧から入力文字を選択できます。

### 2-6. トリガーの表記
表示例の6行目がトリガーです。  
トリガーは、パラメータではなくサービスコール(std_srvs/Trigger)を発生させます。
この表示に対応するConfig fileでの記述は下記となります。
~~~
"Trigger:pshift_genpc","3D撮像"
~~~
＜実行＞ボタンを押すと、サービスコールが実行され、その結果がアラートに表示されます。

|処理結果|
:----:
|成否:OK(True)|
|メッセージ:400000 points scanned|
|＜Close＞|

## 3.パラメータの保存  
起動パラメータにdump:=...にてyamlファイルが指定されているときは、＜保存＞ボタンの操作により現在のパラメータを当該ファイルに書き込みます。現行仕様との差異は以下
- 保存先に存在しないパラメータは追加しない

